import{r as v,c as _,o as q,a as r,b as e,d as m,t as l,F as $,e as j,f as d,g as i}from"./app2.js";const F={class:"w-full max-w-7xl mx-auto px-4"},I={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4"},L={class:"block sm:inline"},D={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4"},E={class:"block sm:inline"},S={key:3,class:"text-center py-8"},M={key:4,class:"text-center py-8"},R={class:"text-red-600 mb-2"},X={key:5,class:"text-center py-8"},A={key:6,class:"flex flex-col md:flex-row gap-6"},B={class:"md:w-2/3 w-full"},N={class:"flex-shrink-0"},P=["src","alt"],Q={class:"flex-1"},T={class:"font-medium"},V={class:"text-xs text-gray-500"},W={class:"font-medium"},H={class:"flex items-center"},K=["onClick"],O={class:"w-8 text-center"},U=["onClick"],z={class:"font-medium"},G=["onClick"],J={class:"md:w-1/3 bg-white rounded-lg shadow p-6"},Y={class:"flex justify-between text-sm mb-3"},Z={class:"flex justify-between text-sm mb-3"},tt={class:"flex justify-between text-lg font-semibold border-t border-gray-200 pt-4 mt-4"},nt={__name:"CartPage",setup(et){const o=v([]),x=v(!0),p=v(null),c=v(""),u=v(""),f=_(()=>o.value.length),b=_(()=>o.value.reduce((n,t)=>n+t.price*t.quantity,0)),k=async()=>{x.value=!0,p.value=null;try{const n=document.querySelector('meta[name="csrf-token"]');n&&(d.defaults.headers.common["X-CSRF-TOKEN"]=n.getAttribute("content")),d.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",d.defaults.headers.common.Accept="application/json";const t=document.cookie.split("; ").find(a=>a.startsWith("cart_session="));if(t){const a=t.split("=")[1];d.defaults.headers.common["X-Cart-ID"]=a}const s=await d.get("/api/cart");s.data&&s.data.items?o.value=s.data.items:o.value=[]}catch{p.value="Не удалось загрузить корзину. Пожалуйста, попробуйте позже.",u.value="Не удалось загрузить корзину. Пожалуйста, попробуйте позже."}finally{x.value=!1}},y=async(n,t)=>{if(!(t<1))try{await d.patch(`/api/cart/items/${n}`,{quantity:t});const s=o.value.findIndex(a=>a.id===n);s!==-1&&(o.value[s].quantity=t,c.value="Количество товара успешно обновлено"),h()}catch{u.value="Не удалось обновить количество товара"}},w=async n=>{const t=o.value.findIndex(a=>a.id===n);if(t===-1)return;const s=o.value[t].quantity;s===1?g(n):y(n,s-1)},C=async n=>{const t=o.value.findIndex(a=>a.id===n);if(t===-1)return;const s=o.value[t].quantity;y(n,s+1)},g=async n=>{try{await d.delete(`/api/cart/items/${n}`),o.value=o.value.filter(t=>t.id!==n),c.value="Товар удален из корзины",h()}catch{u.value="Не удалось удалить товар из корзины"}},h=()=>{const n=o.value.reduce((s,a)=>s+a.quantity,0);document.dispatchEvent(new CustomEvent("cart:updated",{detail:{count:n}})),document.querySelectorAll(".cart-counter").forEach(s=>{s.textContent=n,n>0?s.classList.remove("hidden"):s.classList.add("hidden")})};return q(()=>{k();const n=new URLSearchParams(window.location.search);n.has("success")&&(c.value=n.get("success")),n.has("error")&&(u.value=n.get("error"))}),(n,t)=>(i(),r("div",F,[t[19]||(t[19]=e("h1",{class:"text-2xl font-bold mb-6"},"Корзина",-1)),c.value?(i(),r("div",I,[e("span",L,l(c.value),1),e("button",{onClick:t[0]||(t[0]=s=>c.value=""),class:"absolute top-0 right-0 px-4 py-3"},"×")])):m("",!0),u.value?(i(),r("div",D,[e("span",E,l(u.value),1),e("button",{onClick:t[1]||(t[1]=s=>u.value=""),class:"absolute top-0 right-0 px-4 py-3"},"×")])):m("",!0),m("",!0),x.value?(i(),r("div",S,t[9]||(t[9]=[e("p",{class:"text-gray-600"},"Загрузка корзины...",-1)]))):p.value?(i(),r("div",M,[e("p",R,l(p.value),1),e("button",{onClick:t[4]||(t[4]=s=>n.showDebug=!n.showDebug),class:"mt-2 px-2 py-1 bg-gray-200 text-gray-800 rounded text-xs"},l(n.showDebug?"Скрыть отладку":"Показать отладку"),1)])):f.value===0?(i(),r("div",X,t[10]||(t[10]=[e("p",{class:"text-gray-600 mb-4"},"Ваша корзина пуста",-1),e("a",{href:"/",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors"},"Перейти к покупкам",-1)]))):(i(),r("div",A,[e("div",B,[(i(!0),r($,null,j(o.value,s=>(i(),r("div",{key:s.id,class:"flex items-center p-4 border-b border-gray-200 gap-4"},[e("div",N,[e("img",{src:s.product.image_url,alt:s.product.name,class:"w-20 h-20 object-cover rounded"},null,8,P)]),e("div",Q,[e("h3",T,l(s.product.name),1),e("p",V,l(s.product.category.name),1)]),e("div",W,l(s.price.toFixed(2))+" $ ",1),e("div",H,[e("button",{onClick:a=>w(s.id),class:"w-6 h-6 flex items-center justify-center bg-gray-100 hover:bg-gray-200 rounded"},t[11]||(t[11]=[e("span",null,"-",-1)]),8,K),e("span",O,l(s.quantity),1),e("button",{onClick:a=>C(s.id),class:"w-6 h-6 flex items-center justify-center bg-gray-100 hover:bg-gray-200 rounded"},t[12]||(t[12]=[e("span",null,"+",-1)]),8,U)]),e("div",z,l((s.price*s.quantity).toFixed(2))+" $ ",1),e("button",{onClick:a=>g(s.id),class:"text-red-500 hover:text-red-700 text-xl"},t[13]||(t[13]=[e("span",null,"×",-1)]),8,G)]))),128))]),e("div",J,[t[17]||(t[17]=e("h3",{class:"text-xl font-semibold mb-4"},"Итог заказа",-1)),e("div",Y,[t[14]||(t[14]=e("span",null,"Количество товаров:",-1)),e("span",null,l(f.value),1)]),e("div",Z,[t[15]||(t[15]=e("span",null,"Подытог:",-1)),e("span",null,l(b.value.toFixed(2))+" $",1)]),e("div",tt,[t[16]||(t[16]=e("span",null,"Итого:",-1)),e("span",null,l(b.value.toFixed(2))+" $",1)]),t[18]||(t[18]=e("a",{href:"/checkout",class:"block w-full bg-blue-600 hover:bg-blue-700 text-white text-center py-3 rounded-md font-medium mt-4 transition-colors"}," Оформить заказ ",-1))])]))]))}};export{nt as default};
