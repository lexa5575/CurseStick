import{r as v,c as U,o as I,a as n,b as e,d as p,t as r,w as u,v as m,n as d,h as k,i as S,F as q,e as A,j as V,k as P,l as F,f as y,g as i}from"./app2.js";const D={class:"w-full max-w-7xl mx-auto px-4"},O={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4"},W={class:"block sm:inline"},R={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4"},T={class:"block sm:inline"},$={key:2,class:"text-center py-8"},j={key:3,class:"text-center py-8"},z={class:"text-red-600 mb-2"},E={key:4,class:"text-center py-8"},H={key:5,class:"flex flex-col lg:flex-row gap-8"},B={class:"lg:w-2/3 lg:pr-8 mb-8 lg:mb-0"},K={class:"bg-white rounded-lg shadow p-6"},L={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},X={key:0,class:"text-red-500 text-sm mt-1"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Z={key:0,class:"text-red-500 text-sm mt-1"},G={class:"mb-4"},J={key:0,class:"text-red-500 text-sm mt-1"},Q={class:"mb-4"},ee={class:"grid grid-cols-3 gap-4 mb-4"},te={key:0,class:"text-red-500 text-sm mt-1"},oe={key:0,class:"text-red-500 text-sm mt-1"},ae={key:0,class:"text-red-500 text-sm mt-1"},le={class:"mb-6"},se={class:"mb-4"},ne={class:"lg:w-1/3"},ie={class:"bg-white rounded-lg shadow p-6 sticky top-4"},re={class:"mb-4"},ue={class:"max-h-48 overflow-y-auto mb-4"},de=["src","alt"],pe={class:"flex-1"},ce={class:"font-medium"},me={class:"text-sm text-gray-500"},ve={class:"font-medium"},ge={class:"border-t border-gray-200 pt-4"},ye={class:"flex justify-between mb-2"},be={class:"flex justify-between font-semibold text-lg mt-4"},fe={class:"mb-4"},he={class:"space-y-3"},xe={class:"ml-3"},_e={class:"ml-3"},we={key:0,class:"text-red-500 text-sm mt-2"},ke={class:"flex items-start cursor-pointer"},Ve={key:0,class:"text-red-500 text-sm mt-2 ml-7"},Me=["disabled"],Ce={class:"flex items-center justify-center space-x-2"},Ne={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ue={key:1},Ie={key:2},Se={key:3},qe={key:4},Ae={key:0,class:"absolute bottom-0 left-0 h-1 bg-blue-400 animate-pulse",style:{width:"100%"}},Pe={key:0,class:"text-gray-500 text-xs text-center mt-2 animate-pulse"},Fe={key:1,class:"text-gray-500 text-xs text-center mt-2 animate-pulse"},We={__name:"CheckoutPage",setup(De){const x=v(!0),h=v(null),g=v([]),o=v({name:"",email:"",phone:"",company:"",street:"",house:"",city:"",state:"",postal_code:"",country:"United States",comment:"",payment_method:"",ageVerified:!1}),b=v(""),f=v(""),w=U(()=>g.value.reduce((s,t)=>s+t.price*t.quantity,0)),c=v(!1),l=v({}),M=()=>{l.value={};let s=!0;return o.value.name.trim()||(l.value.name="Name is required",s=!1),o.value.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.value.email)||(l.value.email="Invalid email format",s=!1):(l.value.email="Email is required",s=!1),o.value.street.trim()||(l.value.street="Address is required",s=!1),o.value.city.trim()||(l.value.city="City is required",s=!1),o.value.state.trim()||(l.value.state="State is required",s=!1),o.value.postal_code.trim()||(l.value.postal_code="Zipcode is required",s=!1),s},C=async()=>{if(f.value="",b.value="",!!M()){if(o.value.payment_method||(l.value.payment_method="Please select a payment method",isValid=!1),!o.value.ageVerified){l.value.ageVerified="You must confirm that you are at least 21 years old to continue";return}c.value=!0;try{const s=await y.post("/api/checkout/process",o.value);if(s.data.success){b.value=s.data.message||"Order successfully placed!";const t=s.data.redirect_url||`/orders/${s.data.order_id}/confirmation`;console.log("Redirecting to:",t),setTimeout(()=>{window.location.href=t},1500)}}catch(s){s.response&&s.response.status===422?l.value=s.response.data.errors||{}:f.value="An error occurred while processing your order. Please try again."}finally{c.value=!1}}},N=async()=>{x.value=!0,h.value=null;try{const s=document.querySelector('meta[name="csrf-token"]');s&&(y.defaults.headers.common["X-CSRF-TOKEN"]=s.getAttribute("content")),y.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",y.defaults.headers.common.Accept="application/json";const t=document.cookie.split("; ").find(_=>_.startsWith("cart_session="));if(t){const _=t.split("=")[1];y.defaults.headers.common["X-Cart-ID"]=_}const a=await y.get("/api/cart");console.log("Ответ API:",a.data),a.data&&a.data.items?(g.value=a.data.items,console.log("Данные корзины загружены:",g.value)):(g.value=[],console.log("Корзина пуста или не найдена:",a.data))}catch(s){h.value="Failed to load cart data. Please try again later.",console.error("Ошибка при загрузке данных корзины:",s)}finally{x.value=!1}};return I(()=>{N()}),(s,t)=>(i(),n("div",D,[t[32]||(t[32]=e("h1",{class:"text-2xl font-bold mb-6"},"Оформление заказа",-1)),b.value?(i(),n("div",O,[e("span",W,r(b.value),1),e("button",{onClick:t[0]||(t[0]=a=>b.value=""),class:"absolute top-0 right-0 px-4 py-3"},"×")])):p("",!0),f.value&&!Object.keys(l.value).length?(i(),n("div",R,[e("span",T,r(f.value),1),e("button",{onClick:t[1]||(t[1]=a=>f.value=""),class:"absolute top-0 right-0 px-4 py-3"},"×")])):p("",!0),x.value?(i(),n("div",$,t[16]||(t[16]=[e("p",{class:"text-gray-600"},"Загрузка данных...",-1)]))):h.value?(i(),n("div",j,[e("p",z,r(h.value),1),t[17]||(t[17]=e("a",{href:"/cart",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors"},"Вернуться в корзину",-1))])):g.value.length===0?(i(),n("div",E,t[18]||(t[18]=[e("p",{class:"text-gray-600 mb-4"},"Ваша корзина пуста",-1),e("a",{href:"/",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors"},"Перейти к покупкам",-1)]))):(i(),n("div",H,[e("div",B,[e("div",K,[t[22]||(t[22]=e("h2",{class:"text-xl font-semibold mb-4"},"Информация о доставке",-1)),t[23]||(t[23]=e("div",{class:"mb-6"},[e("h3",{class:"text-lg font-medium"},"Адрес доставки")],-1)),e("div",L,[e("div",null,[u(e("input",{type:"email",id:"email","onUpdate:modelValue":t[2]||(t[2]=a=>o.value.email=a),class:d(["w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.email,"border-gray-300":!l.value.email}]),placeholder:"Email",required:""},null,2),[[m,o.value.email]]),l.value.email?(i(),n("p",X,r(l.value.email),1)):p("",!0)]),e("div",null,[u(e("input",{type:"tel",id:"phone","onUpdate:modelValue":t[3]||(t[3]=a=>o.value.phone=a),class:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Phone (optional)"},null,512),[[m,o.value.phone]])])]),e("div",Y,[e("div",null,[u(e("input",{type:"text",id:"name","onUpdate:modelValue":t[4]||(t[4]=a=>o.value.name=a),class:d(["w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.name,"border-gray-300":!l.value.name}]),placeholder:"Name",required:""},null,2),[[m,o.value.name]]),l.value.name?(i(),n("p",Z,r(l.value.name),1)):p("",!0)]),e("div",null,[u(e("input",{type:"text",id:"company","onUpdate:modelValue":t[5]||(t[5]=a=>o.value.company=a),class:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Company (optional)"},null,512),[[m,o.value.company]])])]),e("div",G,[u(e("input",{type:"text",id:"street","onUpdate:modelValue":t[6]||(t[6]=a=>o.value.street=a),placeholder:"123 Main St",class:d([{"border-red-500":l.value.street,"border-gray-300":!l.value.street},"mt-1 block w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm"])},null,2),[[m,o.value.street]]),l.value.street?(i(),n("p",J,r(l.value.street),1)):p("",!0)]),e("div",Q,[u(e("input",{type:"text",id:"house","onUpdate:modelValue":t[7]||(t[7]=a=>o.value.house=a),placeholder:"Apt, Suite, Unit, etc. (optional)",class:"mt-1 block w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm"},null,512),[[m,o.value.house]])]),e("div",ee,[e("div",null,[u(e("input",{type:"text",id:"city","onUpdate:modelValue":t[8]||(t[8]=a=>o.value.city=a),class:d(["w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.city,"border-gray-300":!l.value.city}]),placeholder:"City",required:""},null,2),[[m,o.value.city]]),l.value.city?(i(),n("p",te,r(l.value.city),1)):p("",!0)]),e("div",null,[u(e("select",{id:"state","onUpdate:modelValue":t[9]||(t[9]=a=>o.value.state=a),class:d(["w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.state,"border-gray-300":!l.value.state}]),required:""},t[19]||(t[19]=[S('<option value="" disabled>Select a state</option><option value="Alabama">Alabama</option><option value="Alaska">Alaska</option><option value="Arkansas">Arkansas</option><option value="California">California</option><option value="Colorado">Colorado</option><option value="Connecticut">Connecticut</option><option value="Delaware">Delaware</option><option value="Florida">Florida</option><option value="Georgia">Georgia</option><option value="Hawaii">Hawaii</option><option value="Idaho">Idaho</option><option value="Illinois">Illinois</option><option value="Indiana">Indiana</option><option value="Iowa">Iowa</option><option value="Kansas">Kansas</option><option value="Kentucky">Kentucky</option><option value="Louisiana">Louisiana</option><option value="Maine">Maine</option><option value="Maryland">Maryland</option><option value="Massachusetts">Massachusetts</option><option value="Michigan">Michigan</option><option value="Minnesota">Minnesota</option><option value="Mississippi">Mississippi</option><option value="Missouri">Missouri</option><option value="Montana">Montana</option><option value="Nebraska">Nebraska</option><option value="Nevada">Nevada</option><option value="New Hampshire">New Hampshire</option><option value="New Jersey">New Jersey</option><option value="New Mexico">New Mexico</option><option value="New York">New York</option><option value="North Carolina">North Carolina</option><option value="North Dakota">North Dakota</option><option value="Ohio">Ohio</option><option value="Oklahoma">Oklahoma</option><option value="Oregon">Oregon</option><option value="Pennsylvania">Pennsylvania</option><option value="Rhode Island">Rhode Island</option><option value="South Carolina">South Carolina</option><option value="South Dakota">South Dakota</option><option value="Tennessee">Tennessee</option><option value="Texas">Texas</option><option value="Utah">Utah</option><option value="Vermont">Vermont</option><option value="Virginia">Virginia</option><option value="Washington">Washington</option><option value="West Virginia">West Virginia</option><option value="Wisconsin">Wisconsin</option><option value="Wyoming">Wyoming</option>',50)]),2),[[k,o.value.state]]),l.value.state?(i(),n("p",oe,r(l.value.state),1)):p("",!0)]),e("div",null,[u(e("input",{type:"text",id:"postal_code","onUpdate:modelValue":t[10]||(t[10]=a=>o.value.postal_code=a),placeholder:"00000",class:d([{"border-red-500":l.value.postal_code,"border-gray-300":!l.value.postal_code},"mt-1 block w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm"])},null,2),[[m,o.value.postal_code]]),l.value.postal_code?(i(),n("p",ae,r(l.value.postal_code),1)):p("",!0)])]),e("div",le,[u(e("select",{id:"country","onUpdate:modelValue":t[11]||(t[11]=a=>o.value.country=a),class:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"},t[20]||(t[20]=[e("option",{value:"United States"},"United States",-1)]),512),[[k,o.value.country]])]),e("div",se,[t[21]||(t[21]=e("label",{for:"comment",class:"block text-gray-700 mb-2"},"Комментарий к заказу",-1)),u(e("textarea",{id:"comment","onUpdate:modelValue":t[12]||(t[12]=a=>o.value.comment=a),class:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Дополнительная информация для курьера"},null,512),[[m,o.value.comment]])])])]),e("div",ne,[e("div",ie,[t[30]||(t[30]=e("h2",{class:"text-xl font-semibold mb-4"},"Ваш заказ",-1)),e("div",re,[e("div",ue,[(i(!0),n(q,null,A(g.value,a=>(i(),n("div",{key:a.id,class:"flex items-center mb-3 pb-3 border-b border-gray-100"},[e("img",{src:a.product.image_url,alt:a.product.name,class:"w-12 h-12 object-cover rounded mr-3"},null,8,de),e("div",pe,[e("p",ce,r(a.product.name),1),e("p",me,r(a.quantity)+" x "+r(a.price.toFixed(2))+" $",1)]),e("div",ve,r((a.price*a.quantity).toFixed(2))+" $ ",1)]))),128))]),e("div",ge,[e("div",ye,[t[24]||(t[24]=e("span",null,"Подытог:",-1)),e("span",null,r(w.value.toFixed(2))+" $",1)]),e("div",be,[t[25]||(t[25]=e("span",null,"Итого:",-1)),e("span",null,r(w.value.toFixed(2))+" $",1)])])]),e("div",fe,[t[28]||(t[28]=e("h3",{class:"text-lg font-medium mb-2"},"Payment Method",-1)),e("div",{class:d(["transition-all duration-300 ease-in-out",{"bg-green-50 border border-green-200 rounded-lg p-3":o.value.payment_method,"bg-yellow-50 border border-yellow-200 rounded-lg p-3":!o.value.payment_method||l.value.payment_method}])},[e("div",he,[e("label",{class:d(["flex items-center p-2 cursor-pointer rounded-md",{"bg-green-100":o.value.payment_method==="zelle"}])},[u(e("input",{type:"radio",name:"payment_method",value:"zelle","onUpdate:modelValue":t[13]||(t[13]=a=>o.value.payment_method=a),class:"h-5 w-5 text-blue-600 focus:ring-blue-500 transition-all duration-200 ease-in-out"},null,512),[[V,o.value.payment_method]]),e("div",xe,[e("span",{class:d(["font-medium",{"text-green-700":o.value.payment_method==="zelle"}])},"Zelle",2),t[26]||(t[26]=e("p",{class:"text-sm text-gray-500"},"Instant bank transfers using Zelle service",-1))])],2),e("label",{class:d(["flex items-center p-2 cursor-pointer rounded-md",{"bg-green-100":o.value.payment_method==="crypto"}])},[u(e("input",{type:"radio",name:"payment_method",value:"crypto","onUpdate:modelValue":t[14]||(t[14]=a=>o.value.payment_method=a),class:"h-5 w-5 text-blue-600 focus:ring-blue-500 transition-all duration-200 ease-in-out"},null,512),[[V,o.value.payment_method]]),e("div",_e,[e("span",{class:d(["font-medium",{"text-green-700":o.value.payment_method==="crypto"}])},"Cryptocurrency",2),t[27]||(t[27]=e("p",{class:"text-sm text-gray-500"},"Pay using Bitcoin, Ethereum or other cryptocurrencies",-1))])],2)]),l.value.payment_method?(i(),n("p",we,r(l.value.payment_method),1)):p("",!0)],2)]),e("div",{class:d(["mb-4 transition-all duration-300 ease-in-out",{"bg-green-50 border border-green-200 rounded-lg p-3":o.value.ageVerified,"bg-yellow-50 border border-yellow-200 rounded-lg p-3":!o.value.ageVerified}])},[e("label",ke,[u(e("input",{type:"checkbox","onUpdate:modelValue":t[15]||(t[15]=a=>o.value.ageVerified=a),class:"mt-1 mr-2 h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded transition-all duration-200 ease-in-out",id:"age-verification"},null,512),[[P,o.value.ageVerified]]),e("span",{class:d(["text-sm",{"text-green-700 font-medium":o.value.ageVerified,"text-gray-700":!o.value.ageVerified}])}," I confirm that I am at least 21 years of age or older and legally allowed to purchase the products in this order. ",2)]),l.value.ageVerified?(i(),n("p",Ve,r(l.value.ageVerified),1)):p("",!0)],2),e("button",{onClick:F(C,["prevent"]),disabled:c.value||!o.value.ageVerified||!o.value.payment_method,class:d(["relative block w-full text-center py-3 rounded-md font-medium transition-all duration-300 ease-in-out overflow-hidden",{"bg-blue-600 hover:bg-blue-700 text-white":o.value.ageVerified&&o.value.payment_method&&!c.value,"bg-gray-400 cursor-not-allowed text-white":(!o.value.ageVerified||!o.value.payment_method)&&!c.value,"bg-blue-600 cursor-wait text-white opacity-80":c.value}])},[e("div",Ce,[c.value?(i(),n("svg",Ne,t[29]||(t[29]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):p("",!0),c.value?(i(),n("span",Ue,"Processing order...")):o.value.payment_method?o.value.ageVerified?(i(),n("span",qe,"Place Order")):(i(),n("span",Se,"Age verification required")):(i(),n("span",Ie,"Select payment method"))]),c.value?(i(),n("div",Ae)):p("",!0)],10,Me),o.value.payment_method?o.value.ageVerified?p("",!0):(i(),n("p",Fe," Please check the box above to confirm your age before proceeding ")):(i(),n("p",Pe," Please select a payment method to continue ")),t[31]||(t[31]=e("a",{href:"/cart",class:"block text-center mt-4 text-blue-600 hover:text-blue-800"}," Return to Cart ",-1))])])]))]))}};export{We as default};
